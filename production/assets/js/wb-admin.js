class WbAdmin{constructor(){this.pageCurrent=""}build(){getUrlWord("admin")&&(this.updateVariable(),this.buildMenuDifeneActive(),this.builTableTdWrapper())}updateVariable(){this.$page=document.querySelector("#mainContent"),document.contains(this.$page)&&(this.$btBlog=this.$page.querySelector('[data-id="btAdminBlog"]'),this.$btUpload=this.$page.querySelector('[data-id="btAdminImage"]'),this.$btLogout=this.$page.querySelector('[data-id="btAdminLogout"]'))}buildMenuDifeneActive(){let t=window.location.href.split("/"),e=t[t.length-2],i=e.charAt(0).toUpperCase()+e.slice(1),a=document.querySelector('#mainContent [data-id="btAdmin'+i+'"]');null!==a&&a.parentNode.classList.add("menu-tab-active")}builTableTdWrapper(){let t=document.querySelectorAll(".td-wrapper");Array.prototype.forEach.call(t,function(t){t.onclick=function(){t.classList.contains("td-wrapper-auto")?t.classList.remove("td-wrapper-auto"):t.classList.add("td-wrapper-auto")}})}}class WbAdminBlog{constructor(){}build(){getUrlWord("blog")&&(CKEDITOR.replace("fieldContentPt",{entities:!1}),CKEDITOR.replace("fieldContentEn",{entities:!1}),this.updateVariable(),this.buildMenu(),this.buildMenuTable(),this.buildMenuThumbnail(),this.watchTitle())}updateVariable(){this.isEdit=!1,this.editId=0,this.$page=document.querySelector("#pageAdminBlog"),this.$contentEdit=document.querySelector("#pageAdminBlogEdit"),this.$contentEditThumbnail=this.$contentEdit.querySelector('[data-id="thumbnailWrapper"]'),this.$contentList=document.querySelector("#pageAdminBlogList"),this.$formRegister=this.$contentEdit.querySelector('[data-id="formRegister"]'),this.$formFieldTitlePt=this.$contentEdit.querySelector('[data-id="fieldTitlePt"]'),this.$formFieldTitleEn=this.$contentEdit.querySelector('[data-id="fieldTitleEn"]'),this.$formFieldUrlPt=this.$contentEdit.querySelector('[data-id="fieldUrlPt"]'),this.$formFieldUrlEn=this.$contentEdit.querySelector('[data-id="fieldUrlEn"]'),this.$formFieldContentPt=this.$contentEdit.querySelector('[data-id="fieldContentPt"]'),this.$formFieldContentEn=this.$contentEdit.querySelector('[data-id="fieldContentEn"]'),this.$formFieldTagPt=this.$contentEdit.querySelector('[data-id="fieldTagPt"]'),this.$formFieldTagEn=this.$contentEdit.querySelector('[data-id="fieldTagEn"]'),this.$formFieldDatePostPt=this.$contentEdit.querySelector('[data-id="fieldDatePostPt"]'),this.$formFieldDatePostEn=this.$contentEdit.querySelector('[data-id="fieldDatePostEn"]'),this.$formFieldDateEditPt=this.$contentEdit.querySelector('[data-id="fieldDateEditPt"]'),this.$formFieldDateEditEn=this.$contentEdit.querySelector('[data-id="fieldDateEditEn"]'),this.$formFieldTagEn=this.$contentEdit.querySelector('[data-id="fieldTagEn"]'),this.$thumbnailWrapper=this.$contentEdit.querySelector('[data-id="thumbnailWrapper"]'),this.thumbnail="",this.thumbnailDefault="default.jpg",this.thumbnailPath="assets/img/blog/thumbnail/",this.$ckEditorPt=CKEDITOR.instances.fieldContentPt,this.$ckEditorEn=CKEDITOR.instances.fieldContentEn}buildMenu(){const t=this;this.$page.querySelector('[data-id="btRegister"]').onclick=function(){t.isEdit?t.editSave():t.saveContent()}}buildMenuThumbnail(){const t=this.$contentEditThumbnail.querySelectorAll(".table");Array.prototype.forEach.call(t,function(t){let e=t.querySelectorAll('[data-action="edit"]');Array.prototype.forEach.call(e,function(t){t.onclick=function(){objWfModal.buildModal("ajax",objWbUrl.getController({folder:"admin",file:"BlogThumbnail"}),"eb")}})})}buildMenuTable(){let t=this,e=this.$contentList.querySelectorAll(".table"),i=this.$contentList.querySelectorAll('[data-id="tableActive"]'),a=this.$contentList.querySelectorAll('[data-id="tableInactive"]');Array.prototype.forEach.call(i,function(t){let e=t.querySelectorAll('[data-action="inactivate"]');Array.prototype.forEach.call(e,function(t){t.onclick=function(){objWfModal.buildModal("confirmation",globalTranslation.confirmationInactivate),objWfModal.buildContentConfirmationAction("objWbAdminBlog.modify("+t.getAttribute("data-id")+', "inactivate")')}})}),Array.prototype.forEach.call(a,function(e){let i=e.querySelectorAll('[data-action="activate"]');Array.prototype.forEach.call(i,function(e){e.onclick=function(){t.modify(e.getAttribute("data-id"),"activate")}})}),Array.prototype.forEach.call(e,function(e){let i=e.querySelectorAll('[data-action="edit"]'),a=e.querySelectorAll('[data-action="delete"]');Array.prototype.forEach.call(i,function(e){e.onclick=function(){t.editId=e.getAttribute("data-id"),t.editLoadData(t.editId)}}),Array.prototype.forEach.call(a,function(t){t.onclick=function(){objWfModal.buildModal("confirmation",globalTranslation.confirmationDelete),objWfModal.buildContentConfirmationAction("objWbAdminBlog.delete("+t.getAttribute("data-id")+")")}})})}editSave(){let t=this,e=new XMLHttpRequest,i=objWbUrl.getController({folder:"admin",file:"BlogEdit"}),a="&action=doUpdate&id="+t.editId+this.buildParameter();this.validateForm()&&(e.open("POST",i,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&t.showResponse(e.responseText)},e.send(a))}editLoadData(t){let e=this,i=new XMLHttpRequest,a=objWbUrl.getController({folder:"admin",file:"BlogEdit"}),o="&action=editLoadData&id="+t;i.open("POST",a,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){let t=JSON.parse(i.responseText);document.documentElement.scrollTop=0,e.isEdit=!0,e.editFillField(t),e.thumbnail=t.thumbnail,e.modifyThumbnail()}},i.send(o)}editFillField(t){this.$formFieldTitlePt.value=t.title_pt,this.$formFieldTitleEn.value=t.title_en,this.$formFieldUrlPt.value=t.url_pt,this.$formFieldUrlEn.value=t.url_en,this.$formFieldTagPt.value=t.tag_pt,this.$formFieldTagEn.value=t.tag_en,this.$formFieldDatePostPt.value=t.date_post_pt.substring(0,10),this.$formFieldDatePostEn.value=t.date_post_en.substring(0,10),this.$formFieldDateEditPt.value=t.date_edit_pt.substring(0,10),this.$formFieldDateEditEn.value=t.date_edit_en.substring(0,10),this.editId=t.id,this.$formFieldTagEn.value=t.tag_en,this.$ckEditorPt.setData(t.content_pt,function(){this.checkDirty()}),this.$ckEditorEn.setData(t.content_en,function(){this.checkDirty()})}modify(t,e){let i=this,a=new XMLHttpRequest,o=objWbUrl.getController({folder:"admin",file:"BlogEdit"}),n="&action=doModify&status="+e+"&id="+t;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&i.showResponse(a.responseText)},a.send(n)}delete(t){let e=this,i=new XMLHttpRequest,a=objWbUrl.getController({folder:"admin",file:"BlogEdit"}),o="&action=doDelete&id="+t;i.open("POST",a,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e.showResponse(i.responseText)},i.send(o)}validateForm(){let t=[this.$formFieldTitlePt,this.$formFieldTitleEn,this.$formFieldUrlPt,this.$formFieldUrlEn];return objWfForm.validateEmpty(t)}buildParameter(){return"&titlePt="+this.$formFieldTitlePt.value+"&titleEn="+this.$formFieldTitleEn.value+"&urlPt="+this.$formFieldUrlPt.value+"&urlEn="+this.$formFieldUrlEn.value+"&contentPt="+this.$ckEditorPt.getData()+"&contentEn="+this.$ckEditorEn.getData()+"&datePostPt="+this.$formFieldDatePostPt.value+"&datePostEn="+this.$formFieldDatePostEn.value+"&dateEditPt="+this.$formFieldDateEditPt.value+"&dateEditEn="+this.$formFieldDateEditEn.value+"&thumbnail="+this.thumbnail+"&tagPt="+this.$formFieldTagPt.value+"&tagEn="+this.$formFieldTagEn.value}saveContent(){let t=this;if(!this.validateForm())return;let e=new XMLHttpRequest,i=objWbUrl.getController({folder:"admin",file:"BlogEdit"}),a="&action=doSave"+this.buildParameter();e.open("POST",i,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&200==e.status&&t.showResponse(e.responseText)},e.send(a)}showResponse(t){let e="",i="";switch(console.log(t),t){case"done":location.reload();break;default:e="red",i=globalTranslation.error}objWfNotification.add(i,e)}watchTitle(){let t=this;this.$formFieldTitlePt.addEventListener("focusout",function(){let e=objWbUrl.buildSEO(t.$formFieldTitlePt.value);t.$formFieldUrlPt.value=e}),this.$formFieldTitleEn.addEventListener("focusout",function(){let e=objWbUrl.buildSEO(t.$formFieldTitleEn.value);t.$formFieldUrlEn.value=e})}selectImage(t){let e=t.parentNode.parentNode.parentNode.parentNode.querySelector("header").querySelector('[data-id="imageName"]').innerText;this.thumbnail=e,objWfModal.closeModal(),this.modifyThumbnail()}modifyThumbnail(){let t=this.$thumbnailWrapper.querySelector("table").querySelector('[data-id="thumbnail"]'),e=this.$thumbnailWrapper.querySelector("table").querySelector('[data-id="name"]');""!==this.thumbnail&&null!==this.thumbnail||(this.thumbnail=this.thumbnailDefault),t.setAttribute("src",this.thumbnailPath+this.thumbnail),e.innerHTML=this.thumbnail}}class WbAdminUploadImage{constructor(){this.deleteElement=""}build(){getUrlWord("image")&&(this.updateVariable(),this.buildMenu())}updateVariable(){this.$btUploadThumbnail=document.querySelector('[data-id="btUploadThumbnail"]'),this.$btUploadBanner=document.querySelector('[data-id="btUploadBanner"]')}buildMenu(){const t=this;let e=document.querySelectorAll('[data-action="delete"]');this.$btUploadThumbnail.addEventListener("click",function(e){t.upload(this,"blog/thumbnail/")}),this.$btUploadBanner.addEventListener("click",function(e){t.upload(this,"blog/banner/")}),Array.prototype.forEach.call(e,function(e){e.onclick=function(){t.deleteImage(e)}})}deleteImage(t){this.deleteElement=t,objWfModal.buildModal("confirmation",globalTranslation.confirmationDelete),objWfModal.buildContentConfirmationAction("objWbAdminUploadImage.deleteImageAjax()")}deleteImageAjax(){const t=this,e=new FormData,i=new XMLHttpRequest;let a=this.deleteElement.parentNode.parentNode.parentNode.parentNode.parentNode.querySelector('[data-id="fileName"]').innerText,o=this.deleteElement.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.getAttribute("data-path"),n=this.deleteElement.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;e.append("f",a),e.append("p",o),i.open("POST",objWbUrl.getController({folder:"admin",file:"ImageDelete"})),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(t.buildResponse(i.responseText,n),objWfModal.closeModal())},i.send(e)}upload(t,e){const i=this,a=t.parentNode.parentNode.parentNode.parentNode.parentNode,o=a.querySelector("[type=file]"),n=new FormData,l=new XMLHttpRequest,d=o.files[0],r=objWbUrl.getController({folder:"admin",file:"ImageUpload"});0!==o.files.length?(n.append("p",e),n.append("f",d),this.$btUploadThumbnail.setAttribute("disabled","disabled"),l.open("POST",r),l.onreadystatechange=function(){4==l.readyState&&200==l.status&&(i.$btUploadThumbnail.removeAttribute("disabled"),i.buildResponse(l.responseText,a))},l.send(n)):o.click()}buildResponse(t,e){switch(t){case"fileDeleted":case"uploadDone":objWfNotification.add(globalTranslation[t],"green",e),document.location.reload();break;default:objWfNotification.add(globalTranslation[t],"red",e)}}}class WbManagementAdmin{verifyLoad(){window.addEventListener("load",this.applyClass(),{once:!0})}applyClass(){objWbLogin.build(),objWbAdmin.build(),objWbAdminBlog.build(),objWbAdminUploadImage.build()}}var objWbAdmin=new WbAdmin,objWbAdminBlog=new WbAdminBlog,objWbAdminUploadImage=new WbAdminUploadImage,objWbLogin=new WbLogin,objWbManagementAdmin=new WbManagementAdmin;objWbManagementAdmin.verifyLoad();